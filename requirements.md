# お問い合わせフォーム自動入力・送信ツール 要件定義書

## 1. 概要

本プロジェクトは、指定された企業のウェブサイトURLからお問い合わせフォームを自動的に特定し、事前に設定された内容でフォームの入力と送信を行うNode.js製ローカルアプリケーションを開発することを目的とする。

昨今のウェブサイトで導入されているreCAPTCHAなどのbot検知システムを回避するため、単なるHTTPリクエストではなく、ブラウザを実際に操作するアプローチを採用する。人間が行うような自然な操作をエミュレートし、ウェブサイトからのブロックを回避するための各種対策を講じることで、安定的かつ倫理的な自動化を目指す。

## 2. 機能要件

### 2.1. コア機能

- **URL入力:**
    - 操作対象となる企業のウェブサイトURLをコマンドライン引数や設定ファイルから受け取る。
- **お問い合わせページ特定:**
    - 入力されたURLのウェブサイト内から、「お問い合わせ」「コンタクト」などのキーワードを含むリンクを探索し、お問い合わせフォームが存在するページへ自動で遷移する。
    - 複数の候補が見つかった場合の優先順位付けロジックを持つ。
- **フォーム要素の特定:**
    - 遷移先のページ内にある入力フォーム（`<form>`タグ）を検出する。
    - 各入力フィールド（氏名、会社名、メールアドレス、電話番号、件名、お問い合わせ内容など）を、`name`属性、`id`属性、`<label>`タグの内容などから推測して特定する。
- **フォーム自動入力:**
    - 事前に設定ファイルで定義された内容（氏名、メールアドレス、定型文など）を、特定した入力フィールドに自動で入力する。
    - テキスト入力、テキストエリア入力、ドロップダウン選択、チェックボックス、ラジオボタンの選択に対応する。
- **フォーム送信:**
    - 「送信」「確認」などの文言を持つ送信ボタンを特定し、クリック操作を実行する。
    - 送信後に表示される確認画面やサンクスページへの遷移を検知し、正常に処理が完了したことを確認する。

### 2.2. bot検知回避機能

- **人間らしい操作のエミュレーション:**
    - **自然なマウス操作:** ページ内の要素をクリックする際に、直線的な移動ではなく、人間のような揺らぎのあるマウスカーソル移動をシミュレートする。
    - **ランダムな待機時間:** ページ遷移後や各操作の間に、ランダムな長さの待機時間（例: 1〜3秒）を挿入し、機械的な連続アクセスを避ける。
    - **自然なタイピング:** テキスト入力時に、一括ペーストではなく、人間がタイピングするように1文字ずつランダムな間隔を空けて入力する。
- **reCAPTCHA / hCaptcha への対応:**
    - reCAPTCHAのチェックボックスをクリックする動作を実装する。
    - **注意:** 画像選択式のreCAPTCHAや、v3のようなスコア判定型の認証を完全に自動で突破することは極めて困難である。本要件では、チェックボックスのクリックまでを自動化の範囲とし、画像選択が必要になった場合は処理を中断、または手動介入を促す仕様を想定する。サードパーティの認証解除サービスの利用は、コストと倫理的観点から本プロジェクトのスコープ外とする。
- **ブロック回避策:**
    - **ユーザーエージェントの偽装:** 一般的なブラウザ（Chrome, Firefox, Safariなど）の最新版のユーザーエージェント文字列を複数用意し、実行ごとにランダムで切り替える。
    - **ヘッドレスブラウザの検出回避:** ヘッドレスモード実行時に、`navigator.webdriver`フラグを偽装するなど、自動操作を検知するJavaScriptから処理を隠蔽する。
    - **プロキシの利用（オプション）:** IPアドレスによるブロックを回避するため、設定ファイルで指定されたプロキシサーバーを経由してアクセスする機能を設ける。プロキシのローテーション機能も視野に入れる。
    - **Cookieとローカルストレージの管理:** 実行ごとにクリーンなセッションで開始するか、あるいは前回のCookieを保持して再訪問を装うかを選択できる。

### 2.3. その他

- **設定ファイル:**
    - 入力内容（氏名、会社名、定型文など）、対象URLリスト、プロキシ設定などを外部のJSONまたはYAMLファイルで管理できるようにする。
- **ロギング:**
    - 実行中の各ステップ（ページ遷移、フォーム特定、入力、送信など）の状況をコンソールに分かりやすく出力する。
    - 成功、失敗、エラーなどの結果をログファイルに記録する。
- **エラーハンドリング:**
    - お問い合わせフォームが見つからない、指定された入力項目がない、送信に失敗したなどのケースを適切に処理し、エラーメッセージを記録して処理を終了する。
    - タイムアウト処理を実装し、ページの読み込みや要素の出現が遅い場合に無限待機に陥らないようにする。

## 3. 非機能要件

- **プラットフォーム:** Node.jsが動作するローカル環境（Windows, macOS, Linux）。
- **使用ライブラリ:** ブラウザ操作にはSeleniumとChromeDriverを第一候補とする。
- **保守性:** 機能ごとに処理をモジュール化し、可読性とメンテナンス性の高いコードを記述する。
- **倫理的配慮:** 本ツールは、正当な目的（例: 営業活動の効率化）のために使用されることを想定する。利用規約で禁止されているウェブサイトへの使用や、スパム行為とみなされるような大量送信は行わない。ツールの利用者は、その使用方法について一切の責任を負うものとする。

## 4. 開発マイルストーン（案）

1.  **フェーズ1: 基本機能の実装**
    - 特定のウェブサイト1つを対象に、Seleniumを用いてお問い合わせフォームの入力と送信を自動化するスクリプトを作成する。
2.  **フェーズ2: 汎用化と設定機能**
    - フォーム要素の特定ロジックを汎用化し、複数のサイトに対応できるように改良する。
    - 設定ファイルを導入し、入力内容を外部から変更できるようにする。
3.  **フェーズ3: bot検知回避機能の強化**
    - 人間らしい操作（マウス、タイピング、待機時間）を実装する。
    - ユーザーエージェントの偽装やヘッドレス検出回避策を導入する。
4.  **フェーズ4: 安定性と実用性の向上**
    - 詳細なロギング機能と堅牢なエラーハンドリングを実装する。
    - プロキシ利用などの高度なオプション機能を追加する。
